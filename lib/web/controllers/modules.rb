module Web
  module Controllers
    # Controller to handle all routes relating to modules.
    class Modules < Base
      get '/list/:type' do
        halt unless params['type'].eql?('exploit') || params['type'].eql?('auxiliary')
        namespace = params['type'].eql?('auxiliary') ? Wpxf::Auxiliary : Wpxf::Exploit

        modules = []
        namespace.module_list.each do |m|
          instance = m[:class].new
          modules.push(
            path: m[:name],
            title: instance.module_name,
            desc: instance.module_desc,
            date: instance.module_date,
            type: params['type'],
            name: m[:name].sub(/^#{params['type']}\//, '')
          )
        end

        json modules
      end
    end
  end
end
