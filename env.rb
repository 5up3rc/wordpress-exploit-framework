require 'colorize'
require 'date'
require 'json'
require 'require_all'
require 'sequel'
require 'stringio'
require 'time'
require 'typhoeus'
require 'zip'
require 'yaml'

ENV['RACK_ENV'] = 'development' unless ENV['RACK_ENV']

wpxfbase = __FILE__

while File.symlink?(wpxfbase)
  wpxfbase = File.expand_path(File.readlink(wpxfbase), File.dirname(wpxfbase))
end

app_path = File.expand_path(File.join(File.dirname(wpxfbase)))

$LOAD_PATH.unshift(File.join(app_path, 'lib'))
$LOAD_PATH.unshift(File.join(app_path, 'modules'))

require 'wpxf/core'
require 'wpxf/utility/body_builder'
require 'wpxf/utility/text'
require 'wpxf/utility/reference_inflater'
require_relative 'github_updater'

Wpxf.app_path = app_path
Wpxf.data_directory = File.join(app_path, 'data/')
Wpxf.db_config = YAML.load_file(File.join(app_path, 'db', 'config.yml'))[ENV['RACK_ENV']]

Sequel::Model.plugin :timestamps
Sequel::Model.db = Sequel.connect(Wpxf.db_config)
